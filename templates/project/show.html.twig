{% extends 'site.html.twig' %}

{% block title %}Project{% endblock %}

{% block body %}


{% block content %}
    
    <div class="container-msan site">
        <main class="main">
            <article class="msan-card">
                <header class="msan-card-header">
                    <h5 class="msan-card-title">Description du projet</h5>
                </header>
                <div class="msan-card-body">
                    <div class="description-project text-secondary">
                        {{ project.description }}
                    </div>
            </article>

            {{ form_start(formC) }}
                <fieldset class="form-group row form-item">
                            <div class="col-lg-12 label-form">
                                {{ form_row(formC.content)}}
                            </div>
                </fieldset>

                    <div class="form-group login-button">
                            <div>
                                <button type="submit" class="btn btn-primary form-button">Commenter</button>
                            </div>
                    </div>
            {{ form_end(formC) }}


            {% if project.comments %}
            <div class="comment-project-section">
                <header class="msan-card-header-comments center-item">
                    <h4>Commentaires</h4>
                </header>
                <div class="list-comments-project">
                            {% for comment in project.comments | sort((a, b) => a.createdAt < b.createdAt) %}
                                <div class="comment-item">
                                    <div class="author-comment bold-author"> {{ comment.commentBy.firstname ~' '~ comment.commentBy.lastname}} a ecrit :</div>
                                    <div class="content-comment"> 
                                        {{ comment.content }}
                                    </div>
                                    <div class="date-comment">
                                        <p> le {{comment.createdAt | date("d/m/y") }} à {{ comment.createdAt | date("H:i")}} </p>
                                    </div>
                                </div>
                            {% endfor %}
                </div>
            </div>
            {% endif %}
        </main>
        <div class="sidebar-container">

            <div class="content-project msan-card">
                <div class="msan-card-title content-item">
                    <h4 class="msan-card-title-icn">{{ project.title }}</h4>
                </div>
                <div class="msan-card-published-icn content-item text-primary">{{ project.publishedBy.firstname ~' '~ project.publishedBy.lastname }}</div>
                <div class="msan-card-date-icn content-item text-primary">Publié le {{project.createdAt | date("d/m/y") }} à {{ project.createdAt | date("H:i")}}</div>
                <div class="msan-card-estimation-icn content-item text-secondary"> {{ project.estimatio }} semaines </div>
                <div class="msan-card-vote content-item text-warning"> {{ project.nbreVote}} </div>
                <div class="msan-card-comments content-item text-info"> {{ project.comments | length}}</div>
                <div class="msan-card-category-icn content-item text-primary">
                    Categorie
                </div>
                <div class="border-item border-item-bottom"></div>
                <div class="list-item">
                    {% for category in project.categories  %}
                        <span class="badge bg-light"> {{category.name}} </span>
                    {% endfor %}
                </div>
                <div class="border-item border-item-top"></div>
                <div class="msan-card-technology-icn content-item text-primary">
                    Technologie
                </div>
                <div class="border-item border-item-bottom"></div>
                <div class="list-item">
                    {% for technology in project.technologies  %}
                        <span class="badge bg-dark"> {{technology.name}} </span>
                    {% endfor %}
                </div>
                <div class="border-item"></div>
                {% if app.user.email == project.publishedBy.email %}
                <div class="button-action-project">
                    <a href="{{ path('app_project_edit', {'slug': project.slug }) }}" class="btn btn-primary">Modifier</a>
                    <form method="post" action="{{ path('app_project_delete', {'id': project.id}) }}" 
                          onsubmit="return confirm('Are you sure you want to delete this item?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ project.id) }}">
                            <button class="btn btn-danger">Supprimer</button>
                    </form>
                </div>
                {% endif %}
                {% if app.user.email != project.publishedBy.email %}
                                
                                {% if hasVoted  %}
                                    <div class="button-action-project">
                                        <a href="{{path('app_project_devote', {'slug': project.slug}) }}" class="btn btn-danger">Retirer vote</a>
                                    </div>
                                {% else %}
                                    <div class="button-action-project">
                                        <a href="{{path('app_project_vote', {'slug': project.slug}) }}" class="btn btn-success">Voter</a>
                                    </div>
                                {% endif %}
                {% endif %}

                
                
            </div>
        </div>
    </div>
    {% endblock %}
{% endblock %}
